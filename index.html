<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Static Live Chatting (FBC)</title>
  <style>
    * { box-sizing: border-box; }
    body {
      margin: 0; font-family: sans-serif; background: #111; color: white;
      height: 100vh; display: flex; flex-direction: column;
    }
    #loginScreen, #addPersonMenu {
      position: fixed; inset: 0; background: #111; z-index: 999;
      display: flex; flex-direction: column; align-items: center; justify-content: center;
    }
    #main { flex: 1; display: flex; }
    #sidebar {
      width: 250px; background: #222; padding: 10px; overflow-y: auto;
      border-right: 1px solid #333;
    }
    #chatPanel {
      flex: 1; display: flex; flex-direction: column;
    }
    #messages {
      flex: 1; padding: 10px; overflow-y: auto;
    }
    #inputArea {
      display: flex; padding: 10px; background: #222;
    }
    input, button {
      padding: 10px; border: none; border-radius: 5px; font-size: 16px;
    }
    button { background: #1e90ff; color: white; cursor: pointer; }
    #inputArea input { flex: 1; margin-right: 5px; }
    .msg { margin-bottom: 10px; }
    .msg span { color: #1e90ff; font-weight: bold; }
    #emojiPicker {
      position: absolute; bottom: 70px; right: 20px;
      background: #222; border: 1px solid #444; padding: 10px; display: none;
      max-width: 200px; flex-wrap: wrap;
    }
    #emojiPicker span { font-size: 20px; cursor: pointer; margin: 4px; }
    .friendItem {
      padding: 8px; background: #333; margin: 5px 0;
      border-radius: 6px; cursor: pointer;
    }
    .friendItem:hover { background: #444; }
    #topBar {
      display: flex; justify-content: space-between;
      padding: 10px; background: #222; align-items: center;
    }
    #staticMenu {
      position: fixed; bottom: 10px; right: 10px;
      background: #1e90ff; padding: 10px 15px; border-radius: 10px;
      animation: twinkle 3s infinite;
    }
    @keyframes twinkle {
      0%,100% { box-shadow: 0 0 5px #1e90ff; }
      50% { box-shadow: 0 0 15px #1e90ff; }
    }
  </style>
</head>
<body>

<div id="loginScreen">
  <h2>Static Live Chatting</h2>
  <p style="color: orange;">‚ö†Ô∏è Do not chat sensitive information.</p>
  <input type="text" id="yourName" placeholder="Enter your nickname" />
  <button onclick="enterApp()">Start</button>
</div>

<div id="main" style="display:none;">
  <div id="sidebar">
    <h3>Friends</h3>
    <div id="friendList"></div>
  </div>
  <div id="chatPanel">
    <div id="topBar">
      <button onclick="openAddMenu()">‚ûï Add Person</button>
      <div id="currentChat">No one selected</div>
    </div>
    <div id="messages"></div>
    <div id="inputArea">
      <input type="text" id="msgInput" placeholder="Type your message..." />
      <button onclick="toggleEmoji()">üòÄ</button>
      <button onclick="sendMsg()">Send</button>
    </div>
  </div>
</div>

<!-- Emoji -->
<div id="emojiPicker"></div>

<!-- Add Friend -->
<div id="addPersonMenu" style="display:none;">
  <h3>Add Someone</h3>
  <input type="text" id="friendName" placeholder="Their name" />
  <input type="text" id="friendPass" placeholder="Optional password (key)" />
  <p style="font-size: 13px; color: orange;">This password is your key to chat with them.</p>
  <button onclick="addPerson()">Start Chat</button>
  <button onclick="closeAddMenu()">Cancel</button>
</div>

<!-- Static Menu -->
<div id="staticMenu">
  <a href="https://sites.google.com/view/staticquasar931/gm3z" style="color:white; text-decoration:none;">More Unblocked Games by Static</a>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js"></script>
<script>
  const firebaseConfig = {
    apiKey: "AIzaSyBO7EHU4-_b2NHf7UFYTB8Wolv73Z0P8Fw",
    authDomain: "static-live-chatting.firebaseapp.com",
    databaseURL: "https://static-live-chatting-default-rtdb.firebaseio.com",
    projectId: "static-live-chatting",
    storageBucket: "static-live-chatting.firebasestorage.app",
    messagingSenderId: "578562140653",
    appId: "1:578562140653:web:c12df07155627083e9dfe4"
  };

  const app = firebase.initializeApp(firebaseConfig);
  const db = firebase.database(app);

  let username = "";
  let activeFriend = "";
  let msgRef = null;

  function enterApp() {
    username = document.getElementById("yourName").value.trim();
    if (!username) return alert("Enter your nickname");
    document.getElementById("loginScreen").style.display = "none";
    document.getElementById("main").style.display = "flex";
    loadFriendList();
  }

  function openAddMenu() {
    document.getElementById("addPersonMenu").style.display = "flex";
  }

  function closeAddMenu() {
    document.getElementById("addPersonMenu").style.display = "none";
  }

  function addPerson() {
    const friend = document.getElementById("friendName").value.trim();
    const pass = document.getElementById("friendPass").value.trim();
    if (!friend) return alert("Enter their name");
    const ref = db.ref("friendChats/" + username + "/" + friend);
    if (pass) ref.set({ password: pass });
    else ref.set({ messages: {} });
    closeAddMenu();
    loadFriendList();
  }

  function loadFriendList() {
    const listRef = db.ref("friendChats/" + username);
    listRef.once("value", snap => {
      const data = snap.val() || {};
      const box = document.getElementById("friendList");
      box.innerHTML = "";
      Object.keys(data).forEach(name => {
        const hasPass = data[name].password;
        const div = document.createElement("div");
        div.className = "friendItem";
        div.textContent = name + (hasPass ? " üîí" : " ‚úÖ");
        div.onclick = () => openChat(name, hasPass);
        box.appendChild(div);
      });
    });
  }

  function openChat(friend, locked) {
    if (locked) {
      const entered = prompt("Enter password to message " + friend);
      db.ref("friendChats/" + username + "/" + friend + "/password").once("value", snap => {
        if (snap.val() !== entered) return alert("Wrong password!");
        unlockChat(friend);
      });
    } else {
      unlockChat(friend);
    }
  }

  function unlockChat(friend) {
    activeFriend = friend;
    document.getElementById("currentChat").innerText = friend;
    document.getElementById("messages").innerHTML = "";
    msgRef = db.ref("friendChats/" + username + "/" + friend + "/messages");

    msgRef.on("child_added", snap => {
      const data = snap.val();
      const time = new Date(data.timestamp).toLocaleTimeString();
      const html = `<div class="msg"><span>${data.user}</span> (${time}): ${data.text}</div>`;
      document.getElementById("messages").innerHTML += html;
      saveToLocal(friend, html);
    });

    loadLocal(friend);
  }

  function sendMsg() {
    const text = document.getElementById("msgInput").value.trim();
    if (!text || !msgRef) return;
    msgRef.push({ user: username, text, timestamp: Date.now() });
    document.getElementById("msgInput").value = "";
  }

  function toggleEmoji() {
    const box = document.getElementById("emojiPicker");
    if (box.style.display === "flex") return box.style.display = "none";
    const emojis = "üòÄüòéüòÇüî•‚ù§Ô∏èüëçüò¢üò°ü•≥üéâüíØü§ñüíÄüò≠üôÉüëè‚ú®üß†üò¥ü´°üöÄüåàüéÆüçï".split("");
    box.innerHTML = "";
    emojis.forEach(e => {
      const span = document.createElement("span");
      span.textContent = e;
      span.onclick = () => {
        document.getElementById("msgInput").value += e;
        box.style.display = "none";
      };
      box.appendChild(span);
    });
    box.style.display = "flex";
  }

  function saveToLocal(friend, html) {
    let old = localStorage.getItem("chat-" + friend) || "";
    old += html;
    localStorage.setItem("chat-" + friend, old);
  }

  function loadLocal(friend) {
    const html = localStorage.getItem("chat-" + friend);
    if (html) document.getElementById("messages").innerHTML = html;
  }
</script>
</body>
</html>
