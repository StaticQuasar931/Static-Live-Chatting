<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Static Live Chatting</title>
  <style>
    body {
      margin: 0; font-family: sans-serif; background: #111; color: #fff;
      display: flex; flex-direction: column; height: 100vh;
    }
    #startScreen, #settingsMenu {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: #111; color: white; display: flex; flex-direction: column;
      justify-content: center; align-items: center; z-index: 999;
    }
    #settingsMenu { display: none; background: rgba(0,0,0,0.95); }
    input, button, textarea {
      margin: 6px; padding: 10px; font-size: 16px; border: none;
      border-radius: 5px; outline: none;
    }
    button { background: #1e90ff; color: white; cursor: pointer; }
    #chatContainer { display: flex; flex: 1; }
    #sidebar {
      width: 250px; background: #222; padding: 10px; overflow-y: auto;
      border-right: 1px solid #333;
    }
    #chat {
      flex: 1; display: flex; flex-direction: column;
    }
    #messages {
      flex: 1; overflow-y: auto; padding: 10px;
    }
    .msg {
      margin-bottom: 10px;
    }
    .msg span {
      font-weight: bold; color: #1e90ff;
    }
    #inputArea {
      display: flex; padding: 10px; background: #222;
    }
    #inputArea input {
      flex: 1; margin-right: 5px;
    }
    #emojiBtn {
      background: #555;
    }
    #emojiPicker {
      position: absolute; bottom: 60px; right: 20px;
      background: #222; border: 1px solid #444; padding: 10px;
      display: none; flex-wrap: wrap; max-width: 200px;
    }
    #emojiPicker span {
      cursor: pointer; font-size: 20px; margin: 3px;
    }
    #staticMenu {
      position: fixed; bottom: 10px; right: 10px;
      background: #1e90ff; padding: 10px 15px; border-radius: 10px;
      animation: twinkle 3s infinite;
    }
    @keyframes twinkle {
      0% { box-shadow: 0 0 5px #1e90ff; }
      50% { box-shadow: 0 0 15px #1e90ff; }
      100% { box-shadow: 0 0 5px #1e90ff; }
    }
    #settingsBtn {
      position: absolute; top: 10px; right: 10px; font-size: 18px;
    }
  </style>
</head>
<body>

<div id="startScreen">
  <h2>Static Live Chatting</h2>
  <p><strong>Do NOT share passwords or sensitive info.</strong></p>
  <input type="text" id="username" placeholder="Choose a nickname" />
  <input type="text" id="groupName" placeholder="Group Name (public title)" />
  <input type="password" id="groupPassword" placeholder="Group Chat Password" />
  <button onclick="generatePassword()">Generate Password</button>
  <p id="generatedPass" style="font-size:14px;"></p>
  <button onclick="enterChat()">Enter Chat</button>
</div>

<div id="chatContainer" style="display:none;">
  <div id="sidebar">
    <h3>Chat Info</h3>
    <p><b>User:</b> <span id="sidebarUser"></span></p>
    <p><b>Group:</b> <span id="sidebarGroup"></span></p>
    <p><b>Pass:</b> <span id="sidebarPass"></span></p>
    <h4>People:</h4>
    <div id="userList"></div>
  </div>

  <div id="chat">
    <div id="settingsBtn"><button onclick="openSettings()">‚öôÔ∏è Settings</button></div>
    <div id="messages"></div>
    <div id="inputArea">
      <input type="text" id="msgInput" placeholder="Type a message..." />
      <button id="emojiBtn" onclick="toggleEmoji()">üòÄ</button>
      <button onclick="sendMessage()">Send</button>
    </div>
  </div>
</div>

<div id="emojiPicker"></div>

<div id="settingsMenu">
  <h3>Settings</h3>
  <input type="text" id="newUsername" placeholder="Change Username" />
  <input type="password" id="newPassword" placeholder="Change Group Password" />
  <button onclick="updateUser()">Save</button>
  <button onclick="closeSettings()">Close</button>
</div>

<div id="staticMenu">
  <a href="https://sites.google.com/view/staticquasar931/gm3z" style="color:white; text-decoration:none;">More Unblocked Games by Static</a>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js"></script>
<script>
  const firebaseConfig = {
    apiKey: "AIzaSyBO7EHU4-_b2NHf7UFYTB8Wolv73Z0P8Fw",
    authDomain: "static-live-chatting.firebaseapp.com",
    databaseURL: "https://static-live-chatting-default-rtdb.firebaseio.com",
    projectId: "static-live-chatting",
    storageBucket: "static-live-chatting.firebasestorage.app",
    messagingSenderId: "578562140653",
    appId: "1:578562140653:web:c12df07155627083e9dfe4"
  };

  const app = firebase.initializeApp(firebaseConfig);
  const db = firebase.database(app);

  let username = "";
  let group = "";
  let password = "";
  let chatRef = null;

  function generatePassword() {
    const pass = Math.random().toString(36).substring(2, 10);
    document.getElementById("groupPassword").value = pass;
    document.getElementById("generatedPass").innerText = "Password: " + pass;
  }

  function enterChat() {
    username = document.getElementById("username").value.trim();
    group = document.getElementById("groupName").value.trim();
    password = document.getElementById("groupPassword").value.trim();

    if (!username || !group || !password) {
      alert("Please fill out all fields");
      return;
    }

    document.getElementById("startScreen").style.display = "none";
    document.getElementById("chatContainer").style.display = "flex";

    document.getElementById("sidebarUser").innerText = username;
    document.getElementById("sidebarGroup").innerText = group;
    document.getElementById("sidebarPass").innerText = password;

    const chatID = btoa(group + "-" + password);
    chatRef = db.ref("chats/" + chatID + "/messages");

    chatRef.on("child_added", (snap) => {
      const data = snap.val();
      const time = new Date(data.timestamp).toLocaleString();
      const msgHTML = `<div class="msg"><span>${data.user}</span> (${time}): ${data.text}</div>`;
      document.getElementById("messages").innerHTML += msgHTML;

      saveToLocal(chatID, msgHTML);
    });

    loadLocal(chatID);
  }

  function sendMessage() {
    const msg = document.getElementById("msgInput").value.trim();
    if (!msg || !chatRef) return;
    chatRef.push({ user: username, text: msg, timestamp: Date.now() });
    document.getElementById("msgInput").value = "";
  }

  function toggleEmoji() {
    const picker = document.getElementById("emojiPicker");
    if (picker.style.display === "flex") {
      picker.style.display = "none";
    } else {
      picker.innerHTML = "";
      const emojis = "üòÄüòéüòÇüî•‚ù§Ô∏èüëçüò¢üò°ü•≥üéâüíØü§ñüíÄüò≠üôÉüëè‚ú®üß†üò¥ü´°üöÄüåàüéÆüçï".split("");
      emojis.forEach(e => {
        const span = document.createElement("span");
        span.textContent = e;
        span.onclick = () => {
          document.getElementById("msgInput").value += e;
          toggleEmoji();
        };
        picker.appendChild(span);
      });
      picker.style.display = "flex";
    }
  }

  function openSettings() {
    document.getElementById("settingsMenu").style.display = "flex";
  }

  function closeSettings() {
    document.getElementById("settingsMenu").style.display = "none";
  }

  function updateUser() {
    const newU = document.getElementById("newUsername").value.trim();
    const newP = document.getElementById("newPassword").value.trim();
    if (newU) username = newU;
    if (newP) password = newP;
    alert("Updated. These only apply to new messages.");
    closeSettings();
  }

  function saveToLocal(id, html) {
    let saved = localStorage.getItem("chat-" + id) || "";
    saved += html;
    localStorage.setItem("chat-" + id, saved);
  }

  function loadLocal(id) {
    const data = localStorage.getItem("chat-" + id);
    if (data) document.getElementById("messages").innerHTML = data;
  }
</script>
</body>
</html>
