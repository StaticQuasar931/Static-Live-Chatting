<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Static Live Chatting</title>
  <style>
    body {
      margin: 0;
      font-family: sans-serif;
      background: #111;
      color: #fff;
      display: flex;
      flex-direction: column;
      height: 100vh;
    }
    #login, #settings, #groupCreate {
      position: fixed;
      inset: 0;
      background: #111;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 100;
    }
    input, button {
      padding: 10px;
      font-size: 16px;
      border: none;
      margin: 5px;
      border-radius: 5px;
    }
    button {
      background: #1e90ff;
      color: white;
      cursor: pointer;
    }
    #app {
      display: flex;
      flex: 1;
    }
    #sidebar {
      width: 250px;
      background: #222;
      padding: 10px;
      overflow-y: auto;
    }
    #chatPanel {
      flex: 1;
      display: flex;
      flex-direction: column;
    }
    #topBar {
      display: flex;
      justify-content: space-between;
      padding: 10px;
      background: #333;
    }
    #messages {
      flex: 1;
      padding: 10px;
      overflow-y: auto;
    }
    .msg span {
      color: #1e90ff;
      font-weight: bold;
    }
    .chatItem {
      padding: 8px;
      background: #444;
      margin-bottom: 6px;
      border-radius: 4px;
      cursor: pointer;
    }
    .chatItem:hover {
      background: #555;
    }
    #inputArea {
      display: flex;
      padding: 10px;
      background: #222;
    }
    #inputArea input {
      flex: 1;
      margin-right: 6px;
    }
    #staticMenu {
      position: fixed;
      bottom: 10px;
      left: 10px;
      background: #1e90ff;
      color: white;
      padding: 10px 15px;
      border-radius: 10px;
      animation: twinkle 3s infinite;
    }
    @keyframes twinkle {
      0%, 100% { box-shadow: 0 0 5px #1e90ff; }
      50% { box-shadow: 0 0 15px #1e90ff; }
    }
  </style>
</head>
<body>

<div id="staticMenu">
  <a href="https://sites.google.com/view/staticquasar931/gm3z" style="color:white;text-decoration:none;">
    More Unblocked Games by Static
  </a>
</div>

<div id="login">
  <h2>Static Live Chatting</h2>
  <p>‚ö†Ô∏è Do not chat sensitive info.</p>
  <input id="username" placeholder="Your nickname" />
  <input id="password" type="password" placeholder="Password (chat key)" />
  <button onclick="togglePassword()">üëÅ Show Password</button>
  <button onclick="login()">Log In</button>
</div>

<div id="app" style="display:none;">
  <div id="sidebar">
    <h3>Chats</h3>
    <div id="chatList"></div>
    <hr/>
    <button onclick="openGroup()">‚ûï Create Group</button>
  </div>
  <div id="chatPanel">
    <div id="topBar">
      <div id="chatTitle">No Chat</div>
      <button onclick="openSettings()">‚öôÔ∏è</button>
    </div>
    <div id="messages"></div>
    <div id="inputArea">
      <input id="msgInput" placeholder="Type message..." />
      <button onclick="sendMessage()">Send</button>
    </div>
    <div id="typing" style="padding:5px;color:gray;"></div>
  </div>
</div>

<div id="groupCreate" style="display:none;">
  <h3>Create Group Chat</h3>
  <input id="groupName" placeholder="Group Name" />
  <button onclick="createGroup()">Create</button>
  <button onclick="closeGroup()">Cancel</button>
</div>

<div id="settings" style="display:none;">
  <h3>Settings</h3>
  <input id="newName" placeholder="New Display Name" />
  <button onclick="changeName()">Change Name</button>
  <button onclick="logout()">Lock + Log Out</button>
  <button onclick="closeSettings()">Close</button>
</div>

<!-- Firebase CDN Setup -->
<script src="https://www.gstatic.com/firebasejs/11.5.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/11.5.0/firebase-database-compat.js"></script>
<script>
const firebaseConfig = {
  apiKey: "AIzaSyBO7EHU4-_b2NHf7UFYTB8Wolv73Z0P8Fw",
  authDomain: "static-live-chatting.firebaseapp.com",
  databaseURL: "https://static-live-chatting-default-rtdb.firebaseio.com",
  projectId: "static-live-chatting",
  storageBucket: "static-live-chatting.appspot.com",
  messagingSenderId: "578562140653",
  appId: "1:578562140653:web:c12df07155627083e9dfe4"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

let user = localStorage.getItem("user");
let pass = localStorage.getItem("pass");
let currentChat = "";
let currentType = "private"; // or 'group'

if (user && pass) {
  document.getElementById("login").style.display = "none";
  document.getElementById("app").style.display = "flex";
  loadChats();
}

function togglePassword() {
  const input = document.getElementById("password");
  input.type = input.type === "password" ? "text" : "password";
}

function login() {
  user = document.getElementById("username").value.trim();
  pass = document.getElementById("password").value.trim();
  if (!user || !pass) return alert("Fill in all fields.");
  localStorage.setItem("user", user);
  localStorage.setItem("pass", pass);
  document.getElementById("login").style.display = "none";
  document.getElementById("app").style.display = "flex";
  loadChats();
}

function loadChats() {
  db.ref("users/" + user + "/chats").on("value", snap => {
    const data = snap.val() || {};
    const list = document.getElementById("chatList");
    list.innerHTML = "";
    Object.keys(data).forEach(id => {
      const div = document.createElement("div");
      div.className = "chatItem";
      div.textContent = data[id].name || id;
      div.onclick = () => openChat(id, data[id].name, data[id].type);
      list.appendChild(div);
    });
  });
}

function openChat(id, name, type = "private") {
  currentChat = id;
  currentType = type;
  document.getElementById("chatTitle").textContent = name || id;
  document.getElementById("messages").innerHTML = "";
  const ref = db.ref(`${type}Chats/${id}/messages`);
  ref.off();
  ref.on("child_added", snap => {
    const msg = snap.val();
    const time = new Date(msg.timestamp).toLocaleTimeString();
    const html = `<div class="msg"><span>${msg.sender}</span> (${time}): ${msg.text}</div>`;
    document.getElementById("messages").innerHTML += html;
  });
}

function sendMessage() {
  const text = document.getElementById("msgInput").value.trim();
  if (!text || !currentChat) return;
  db.ref(`${currentType}Chats/${currentChat}/messages`).push({
    sender: user,
    text,
    timestamp: Date.now()
  });
  document.getElementById("msgInput").value = "";
}

function openGroup() {
  document.getElementById("groupCreate").style.display = "flex";
}

function closeGroup() {
  document.getElementById("groupCreate").style.display = "none";
}

function createGroup() {
  const gName = document.getElementById("groupName").value.trim();
  if (!gName) return alert("Enter group name.");
  const id = "group_" + Date.now();
  db.ref(`groupChats/${id}`).set({
    name: gName,
    createdBy: user,
    members: { [user]: true }
  });
  db.ref(`users/${user}/chats/${id}`).set({
    name: gName,
    type: "group"
  });
  closeGroup();
  loadChats();
  openChat(id, gName, "group");
}

function openSettings() {
  document.getElementById("settings").style.display = "flex";
}
function closeSettings() {
  document.getElementById("settings").style.display = "none";
}
function changeName() {
  const newName = document.getElementById("newName").value.trim();
  if (!newName) return;
  user = newName;
  localStorage.setItem("user", user);
  alert("Name changed.");
  closeSettings();
  loadChats();
}
function logout() {
  localStorage.clear();
  location.reload();
}
</script>
</body>
</html>
